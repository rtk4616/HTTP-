<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <title>活动页面</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta content="telephone=no,email=no" name="format-detection">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">

    <link rel="stylesheet" href="static/css/reset.css">
    <link rel="stylesheet" href="static/css/global-mobile.css">
    <link rel="stylesheet" href="static/css/activity-homepage.css">
</head>

<body>

<!-- 中部弹出的灰色错误提示框 -->
<div class="error-tip-box tran-opacity-hide">
    <span class="error-tip-font" id="error-tip-font"></span>
</div>

<!--main-->
<div class="main over-hid">

    <!-- 活动主题logo -->
    <p class="activity-theme">
        <img src="static/img/activity-theme.png" alt="">
    </p>

    <!--  -->
    <div class="activity-bg-wall">

        <!-- 等待开奖中 waiting-prize-wall -->
        <div class="line" id="waiting-prize-wall">
            <p class="title-plate">
                <!--<img src="static/img/prize-setting-title.png" class="common-title-img" alt="" title="奖品设置">-->
                <span class="let-spa-2px common-title">奖品设置</span>
            </p>

            <!-- 奖品板块 -->
            <div class="prize-plate">

                <!-- 成功参加后显示板块 -->
                <p class="success-join-plate">
                    <span class="prize-coming-font">即将开奖 敬请期待</span>
                    <label class="successfully-participate">参与成功</label>
                    <label> 你的券码为：<i id="code-number">XXXXXXX</i> </label>
                    <label>请等待现场开奖~ 大奖正在朝你飞来</label>
                </p>

                <!--旅游目的地板块-->
                <p class="common-destination-plate first-destination-plate">
                    <span class="small-prize-intro">烟雨江南六天双人游 <br> 价值4800元  (3组)</span>
                </p>
                <p class="common-destination-plate second-destination-plate">
                    <span class="small-prize-intro">西双版纳六天双人游 <br> 价值5400元  (3组)</span>
                </p>
                <p class="common-destination-plate third-destination-plate">
                    <span class="small-prize-intro">腾冲五天双人游 <br> 价值5200元  (3组)</span>
                </p>


                <p style="text-align: center; color: #5e5e5e; margin-bottom: 2rem;">获奖幸运儿可以以礼品金额*70%金额折现</p>


                <!-- 立即参与 -->
                <p class="over-hid">
                    <img src="static/img/join-btn.png" class="common-img-style" id="join-btn" alt="" title="立即参与">
                </p>

            </div>
        </div>


        <!-- 活动规则 -->
        <div class="line activity-rule" style="margin-top:2rem;">
            <p class="title-plate">
                <!--<img src="static/img/prize-setting-title.png" class="common-title-img" alt="" title="奖品设置">-->
                <span class="let-spa-2px common-title">活动规则 </span>
            </p>
            <div class="activity-rule-detail">
                <span>1.用户点击“立即参与”并输入手机号码及深大经济   学院毕业晚会门票的入场券编码，点击“参与抽奖”   即可参与抽奖； </span>
                <span>2.每个手机号码仅限对应一条入场券编码；</span>
                <span>3.本次活动通过电子抽奖方式，实时在电子屏中公布中奖入场券编码及对应手机号码；</span>
                <span>4.每位中奖用户需现场确认身份，否则视为自动放弃，将继续抽奖直至奖项领取完毕；</span>
                <span>5.活动结束后，入场券抽奖编码将自动作废；</span>
                <span>6.本活动最终解释权归主办方 <br> &nbsp;&nbsp;&nbsp;&nbsp; 酷蚪网络科技(深圳)有限公司所有。</label></span>
            </div>
        </div>

        <!-- 领奖流程 -->
        <div class="line activity-rule" style="margin-top:2rem;">
            <p class="title-plate">
                <!--<img src="static/img/prize-setting-title.png" class="common-title-img" alt="" title="奖品设置">-->
                <span class="let-spa-2px common-title">领奖流程 </span>
            </p>
            <div class="activity-rule-detail">
                <span> 1.每位中奖用户上台领取奖项，并转发领奖照片至朋友圈，同时向主办方提交身份资料并确认； </span>
                <span>2.活动结束后，主办方会安排客服人员电话联系中奖用户并跟进出游日程。</span>
            </div>
        </div>
    </div>
</div>
<!--main-->

<!-- 全屏遮罩层 -->
<div class="full-screen-div dis-none" id="full-screen-div"></div>


<!-- 弹框-模态框 -->
<div class="modal-box">

    <div class="show-hide-wall">
        <p class="modal-box-title">
            <img src="static/img/close-icon.png"
                 class="close-icon" data-index="1">
        </p>

        <p class="common-p-style modal-box-rule-tips">
            <span>领奖需凭入场券及线上参与界面兑奖(两者需保持一致),请确保券码无误哦！ </span>
        </p>

        <p class="common-p-style">
            <input type="text" class="phone-input modal-input" id="phone-input" maxlength="11" autofocus="autofocus"
                   placeholder="请输入手机号码">
        </p>
        <p class="verify-code-wall">
            <input type="text" class="the-input common-code-input ver-code-input modal-input" maxlength="6"
                   autocomplete="off" placeholder="请输入收到的验证码">
            <span class="placeholder"></span>
            <input type="button" class="get-code-btn" value="获取验证码">
        </p>

        <p class="common-p-style">
            <input type="text" class="draw-num-input modal-input" id="draw-num-input" maxlength="8"
                   placeholder="请输入抽奖劵码">
        </p>

        <p class="common-btn-style" id="draw-btn" data-flag="0">参与抽奖</p>
    </div>


    <div class="show-hide-wall  dis-none">
        <p class="common-p-style join-activity-success-tip">
            <span>恭喜您参与成功！请关注后期抽奖环节</span>
        </p>
        <p class="common-btn-style" id="modal-confirm-btn">确定</p>
    </div>

</div>


<script type="text/javascript" src="static/js/jquery.min.js"></script>
<script type="text/javascript" src="static/js/global-functions-new.js"></script>
<script type="text/javascript">

    const Elements = {
        main: getClassName("main")[0],

        // 中部弹出的灰色 - 错误提示框
        errTipBox: getClassName("error-tip-box")[0],
        errTipFont: getId("error-tip-font"),

        // 全屏遮罩层
        fullScreen: getId("full-screen-div"),

        // 成功参加后显示板块
        successJoinPlate: getClassName("success-join-plate")[0],

        // 目的地
        destinationWall: getId("destination-wall"),

        // 等待开奖
        waitPrizeWall: getId("waiting-prize-wall"),
        // 劵码
        codeNumber: getId("code-number"),

        // 立即参与按钮
        joinBtn: getId("join-btn"),


        /* 弹框 模态框 */

        // 手机号码 input
        phoneInput: getId("phone-input"),
        // 验证码
        verCodeInput: getClassName("ver-code-input")[0],
        getCodeBtn: getClassName("get-code-btn")[0],
        modalBox: getClassName("modal-box")[0],
        closeIcon: getClassName("close-icon")[0],
        drawBtn: getId("draw-btn"),
        // 抽奖劵码 input
        drawNumInput: getId("draw-num-input"),
        // 弹框三个input
        modalInputs: getClassName("modal-input"),
        // 弹框中包围2个模块的 div.show-hide-wall
        showHideWall: getClassName("show-hide-wall"),
        modalConfBtn: getId("modal-confirm-btn"),

    };


    // ajax 配置图
    const AjaxConfMap = {

        // 公共token
        fnCommonToken: function () {
            let commonToken;
            $.ajax({
                type: "post",
                dataType: "json",
                async: false,
                url: "../common/getCommonToken",
                success: function (data) {
                    if (data.ok === true) {
                        commonToken = data.data;
                        // console.log(commonToken);
                    } else {
                        console.log("获取公共token错误提示: " + data.msg);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    // "timeout", "error", "notmodified" 和 "parsererror"。
                    console.log(textStatus);
                }
            });
            return commonToken;
        },


        // 发送验证码
        fnVerCode: function (userNameVal, ele) {

            let codeInstance = SendVerCode();
            if (Elements.phoneInput.value === "") {
                MainConfMap.errorTipBox("*请填写电话号码");
            } else {
                codeInstance.verCode(ele, 60);
            }

            /*$.ajax({
                type: "post",
                dataType: "json",
                async: false,
                url: "../memberLogin/sendLoginValidateMessage",
                data: {
                    "memberId": trim(userNameVal),
                    "commonToken": AjaxConfMap.fnCommonToken()
                },
                success: function (data) {

                    let codeInstance = SendVerCode();
                    if (data.ok === true) {
                        if (Elements.phoneInput.value === "") {
                            MainConfMap.errorTipBox("请填写电话号码");
                        } else {
                            codeInstance.verCode(ele, 60);
                        }

                    } else if (data.ok === false) {
                        if (data.msg !== null && data.msg !== "") {
                            MainConfMap.errorTipBox(data.msg);
                            console.log("发送短信验证码错误提示: " + data.msg);
                        }
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log(textStatus);
                }
            });*/
        },

    };

    // 正则配置图
    const RegExpConfMap = {
        regPhone: /^0?1[3|4|5|8][0-9]\d{8}$/,
        regNum: /\d{8}/,
    };


    const MainConfMap = {

        // 中部弹出的灰色 - 错误提示框
        errorTipBox(errorText) {
            if (hasClass("tran-opacity-hide", Elements.errTipBox)) {
                removeClass("tran-opacity-hide", Elements.errTipBox);
                addClass("tran-opacity-show", Elements.errTipBox);

                this.errTipsFont(errorText);

                // 错误提示弹框设置居中显示
                fnElementCenter(Elements.errTipBox);
            }

            setTimeout(function () {
                if (hasClass("tran-opacity-show", Elements.errTipBox)) {
                    removeClass("tran-opacity-show", Elements.errTipBox);
                    addClass("tran-opacity-hide", Elements.errTipBox);
                }
            }, 2000);
        },
        errTipsFont(errorText) {
            Elements.errTipFont.innerHTML = errorText;
        },

        // 关闭模态框
        closeModalBox(curModalBox) {
            addClass("dis-none", Elements.fullScreen);
            curModalBox.style.cssText +=
                "opacity:0; z-index: -3;" +
                "transition: opacity .2s linear";
        },

    };


    window.onload = function () {

        // 给全屏遮罩层设置高度
        let documentHeight = Math.max(document.documentElement.clientHeight,
            document.body.scrollHeight, document.documentElement.scrollHeight);
        Elements.fullScreen.style.height = documentHeight + "px";


        // 滚动条事件: 模态框居中
        EventUtil.addHandler(window, "scroll", function () {
            fnElementCenter(Elements.modalBox);
        });


        // 打开页面立即判断当前用户是否已经参加活动(根据后台的接口判断)，如果是就显示成功参加后的板块
        let joinFlag = "0";
        if (parseInt(joinFlag, 10) === 1) {
            Elements.successJoinPlate.style.cssText = "display: block; opacity: 1; transform: scale(1); " +
                "transition: transform .4s ease, opacity .4s ease;";
            // 把奖品劵码写入到页面中: (根据接口返回更改)
            Elements.codeNumber.innerHTML = "666666666666";
            Elements.joinBtn.parentNode.style.display = "none";
        }


        // 立即参与按钮
        EventUtil.addHandler(Elements.joinBtn, "click", function () {
            removeClass("dis-none", Elements.fullScreen);

            // 模态框居中
            fnElementCenter(Elements.modalBox);

            setTimeout(function () {
                Elements.modalBox.style.cssText +=
                    "opacity:1; z-index: 3;" +
                    "transition: opacity .3s linear";
            }, 100);
        });


        // 获取验证码事件
        EventUtil.addHandler(Elements.getCodeBtn, "click", function () {
            let usernameVal = trim(Elements.phoneInput.value);
            if (usernameVal === "") {
                MainConfMap.errorTipBox("*请填写电话号码");
            } else {
                AjaxConfMap.fnVerCode(usernameVal, this);
            }
        });

        // 验证码 input
        EventUtil.addHandler(Elements.verCodeInput, "blur", function () {
            const regNum = /\d{6}/g;
            if (this.value !== "") {
                if (regNum.test(this.value) === false) {
                    let msgTips = "*验证码为6位纯数字";
                    MainConfMap.errorTipBox(msgTips);
                }
            }
        });


        // 手机号 input
        EventUtil.addHandler(Elements.phoneInput, "mouseleave", function () {
            if (this.value !== "") {
                if (RegExpConfMap.regPhone.test(this.value)) {
                    /* this.setAttribute("data-flag", 1);*/
                    Elements.drawBtn.style.backgroundColor = "#2496f7";
                    return null;
                } else {
                    MainConfMap.errorTipBox("*请输入正确的手机号！");
                }
            }
        });


        // 抽奖券码 input
        EventUtil.addHandler(Elements.drawNumInput, "mouseleave", function () {
            if (this.value !== "") {
                if (RegExpConfMap.regNum.test(this.value)) {
                    Elements.drawBtn.style.backgroundColor = "#2496f7";
                    return null;
                } else {
                    MainConfMap.errorTipBox("*请输入正确的抽奖劵码！");
                }
            }
        });


        // 关闭弹框
        Elements.closeIcon.addEventListener("click", function () {
            MainConfMap.closeModalBox(Elements.modalBox);
        }, false);


        // 参与抽奖 button
        EventUtil.addHandler(Elements.drawBtn, "click", function () {

            let flag = 0;
            // 弹框中的3个 input
            let modalInputsArr = [].slice.call(Elements.modalInputs);
            modalInputsArr.forEach(function (item) {
                if (item.value === "") {
                    flag = 1;
                }
            });

            if (flag === 1) {
                MainConfMap.errorTipBox("*请填写所有表单！");
                return null;
            }

            // 隐藏当前
            Elements.showHideWall[0].style.display = "none";
            Elements.showHideWall[1].style.display = "block";
        });

        // 弹框确定按钮 关闭弹框, 成功参加板块显示, 立即参加按钮隐藏
        Elements.modalConfBtn.addEventListener("click", function () {
            MainConfMap.closeModalBox(Elements.modalBox);

            // 成功参加板块显示
            Elements.successJoinPlate.style.cssText = "display: block; opacity: 1; transform: scale(1); " +
                "transition: transform .4s ease, opacity .4s ease;";

            let sucJoinPlatePosition = getPosition(Elements.successJoinPlate).top - 60;
            window.scrollTo(0, sucJoinPlatePosition);


            // 把奖品劵码写入到页面中: (根据接口返回更改)
            Elements.codeNumber.innerHTML = "666666666666";

            Elements.joinBtn.parentNode.style.display = "none";

        }, false);

    };


</script>
</body>
</html>